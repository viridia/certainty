<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/compare.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-certainty-ArraySubject.html">ArraySubject</a><ul class='methods'><li data-type='method'><a href="module-certainty-ArraySubject.html#contains">contains</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsAll">containsAll</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsAllIn">containsAllIn</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsAllOf">containsAllOf</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsAny">containsAny</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsAnyIn">containsAnyIn</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsAnyOf">containsAnyOf</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsExactly">containsExactly</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsExactlyIn">containsExactlyIn</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsNone">containsNone</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsNoneIn">containsNoneIn</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#containsNoneOf">containsNoneOf</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#hasLength">hasLength</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#isEmpty">isEmpty</a></li><li data-type='method'><a href="module-certainty-ArraySubject.html#isNotEmpty">isNotEmpty</a></li></ul></li><li><a href="module-certainty-DeferredSubject.html">DeferredSubject</a><ul class='methods'><li data-type='method'><a href="module-certainty-DeferredSubject.html#invoke">invoke</a></li></ul></li><li><a href="module-certainty-FieldValue.html">FieldValue</a><ul class='methods'><li data-type='method'><a href="module-certainty-FieldValue.html#withValue">withValue</a></li></ul></li><li><a href="module-certainty-InOrder.html">InOrder</a><ul class='methods'><li data-type='method'><a href="module-certainty-InOrder.html#inOrder">inOrder</a></li></ul></li><li><a href="module-certainty-ObjectSubject.html">ObjectSubject</a><ul class='methods'><li data-type='method'><a href="module-certainty-ObjectSubject.html#hasField">hasField</a></li><li data-type='method'><a href="module-certainty-ObjectSubject.html#hasOwnField">hasOwnField</a></li><li data-type='method'><a href="module-certainty-ObjectSubject.html#isEmpty">isEmpty</a></li><li data-type='method'><a href="module-certainty-ObjectSubject.html#isNotEmpty">isNotEmpty</a></li></ul></li><li><a href="module-certainty-PromiseSubject.html">PromiseSubject</a><ul class='methods'><li data-type='method'><a href="module-certainty-PromiseSubject.html#eventually">eventually</a></li><li data-type='method'><a href="module-certainty-PromiseSubject.html#fails">fails</a></li><li data-type='method'><a href="module-certainty-PromiseSubject.html#failsWith">failsWith</a></li><li data-type='method'><a href="module-certainty-PromiseSubject.html#succeeds">succeeds</a></li><li data-type='method'><a href="module-certainty-PromiseSubject.html#succeedsWith">succeedsWith</a></li></ul></li><li><a href="module-certainty-Subject.html">Subject</a><ul class='methods'><li data-type='method'><a href="module-certainty-Subject.html#describe">describe</a></li><li data-type='method'><a href="module-certainty-Subject.html#equals">equals</a></li><li data-type='method'><a href="module-certainty-Subject.html#exists">exists</a></li><li data-type='method'><a href="module-certainty-Subject.html#fail">fail</a></li><li data-type='method'><a href="module-certainty-Subject.html#failComparison">failComparison</a></li><li data-type='method'><a href="module-certainty-Subject.html#failEqual">failEqual</a></li><li data-type='method'><a href="module-certainty-Subject.html#failNotEqual">failNotEqual</a></li><li data-type='method'><a href="module-certainty-Subject.html#hasType">hasType</a></li><li data-type='method'><a href="module-certainty-Subject.html#isDeeplyEqualTo">isDeeplyEqualTo</a></li><li data-type='method'><a href="module-certainty-Subject.html#isEqualTo">isEqualTo</a></li><li data-type='method'><a href="module-certainty-Subject.html#isExactly">isExactly</a></li><li data-type='method'><a href="module-certainty-Subject.html#isFalse">isFalse</a></li><li data-type='method'><a href="module-certainty-Subject.html#isFalsey">isFalsey</a></li><li data-type='method'><a href="module-certainty-Subject.html#isGreaterThan">isGreaterThan</a></li><li data-type='method'><a href="module-certainty-Subject.html#isInstanceOf">isInstanceOf</a></li><li data-type='method'><a href="module-certainty-Subject.html#isLessThan">isLessThan</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotDeeplyEqualTo">isNotDeeplyEqualTo</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotEqualTo">isNotEqualTo</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotGreaterThan">isNotGreaterThan</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotInstanceOf">isNotInstanceOf</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotLessThan">isNotLessThan</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotNull">isNotNull</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotNullOrUndefined">isNotNullOrUndefined</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNotUndefined">isNotUndefined</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNull">isNull</a></li><li data-type='method'><a href="module-certainty-Subject.html#isNullOrUndefined">isNullOrUndefined</a></li><li data-type='method'><a href="module-certainty-Subject.html#isTrue">isTrue</a></li><li data-type='method'><a href="module-certainty-Subject.html#isTruthy">isTruthy</a></li><li data-type='method'><a href="module-certainty-Subject.html#isUndefined">isUndefined</a></li><li data-type='method'><a href="module-certainty-Subject.html#named">named</a></li></ul></li><li><a href="module-certainty-SubjectFactory.html">SubjectFactory</a><ul class='methods'><li data-type='method'><a href="module-certainty-SubjectFactory.html#addType">addType</a></li><li data-type='method'><a href="module-certainty-SubjectFactory.html#newSubject">newSubject</a></li></ul></li><li><a href="ProxyBase.html">ProxyBase</a><ul class='methods'><li data-type='method'><a href="ProxyBase.html#.addMethod">addMethod</a></li><li data-type='method'><a href="ProxyBase.html#.addMethods">addMethods</a></li><li data-type='method'><a href="ProxyBase.html#invoke">invoke</a></li></ul></li><li><a href="ThrowStrategy.html">ThrowStrategy</a><ul class='methods'><li data-type='method'><a href="ThrowStrategy.html#fail">fail</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-certainty.html">certainty</a><ul class='methods'><li data-type='method'><a href="module-certainty.html#~ensure">ensure</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#compare">compare</a></li><li><a href="global.html#format">format</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/compare.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var format = require('./format');

function type(v) {
  return typeof v;
}

function inequality(exp, act, path) {
  var strExp = format(exp, 100);
  var strAct = format(act, 100);
  if (strExp.length > 16 || strAct.length > 16) {
    if (path) {
      return 'Expected value of ' + path + ' differs from actual value:\n' +
        '  expected: ' + strExp + '\n' +
        '    actual: ' + strAct;
    } else {
      return 'Expected value differs from actual value:\n' +
        '  expected: ' + strExp + '\n' +
        '    actual: ' + strAct;
    }
  }
  if (path) {
    return 'Expected ' + path + ' to be ' + strExp + ', actual value was ' + strAct + '.';
  } else {
    return 'Expected ' + strAct + ' to be ' + strExp + '.';
  }
}

function propertyKeys(obj) {
  var keys = [];
  for (var k in obj) {
    keys.push(k);
  }
  return keys;
}

/** Function to compute the difference between two values. Note that unlike many other object
    diff implementations, this one tries to 'humanize' the results, summarizing them for
    improved readability.
    @param {string} exp The expected value.
    @param {string} act The actual value.
    @param {string} opt_path The expression used to access the value, such as 'a.b.c'.
    @param {bool} opt_deep Whether to do a deep comparison.
    @param {Array} opt_resukts If non-null, will be used to report the differences between the
        expected and actual values.
 */
function compare(exp, act, opt_path, opt_deep, opt_results) {
  var path = opt_path || '';
  var i, strExp, strAct;
  if (sameValue(exp, act)) {
    return true;
  }
  var et = type(exp);
  var at = type(act);
  if (et !== at || et === 'number' || at === 'boolean' || et === 'undefined'
    || exp === null || act === null) {
    if (opt_results) {
      opt_results.push(inequality(exp, act, path));
    }
    return false;
  } else if (et === 'object') {
    // Shallow comparison
    if (!opt_deep) {
      if (opt_results) {
        opt_results.push(inequality(exp, act, path));
      }
      return false;
    }

    // Compare prototypes
    var eProto = Object.getPrototypeOf(exp);
    var aProto = Object.getPrototypeOf(act);
    if (eProto != aProto) {
      if (opt_results) {
        if (path) {
          opt_results.push(
            'Expected ' + path + ' to be type ' + eProto + ', actual value was type ' +
              aProto + '.');
        } else {
          opt_results.push(
            'Expected ' + format(act, 80) + ' to be type ' + eProto +
              ', actual value was type ' + aProto + '.');
        }
      }
      return false;
    }

    if (Array.isArray(exp) &amp;&amp; Array.isArray(act)) {
      // do array comparison
    }

    // Handle regular expression objects.
    if (exp instanceof RegExp) {
      if (opt_deep &amp;&amp; (exp + '') === (act + '')) {
        return true;
      }
      if (opt_results) {
        opt_results.push(inequality(exp, act, path));
      }
      return false;
    }

    // Handle 'date' objects.
    if (exp instanceof Date) {
      if (opt_deep &amp;&amp; exp.getTime() === act.getTime()) {
        return true;
      }
      if (opt_results) {
        opt_results.push(inequality(exp, act, path));
      }
      return false;
    }

    // Compare individual properties.
    var same = true;
    var eKeys = propertyKeys(exp);
    var aKeys = propertyKeys(act);
    eKeys.sort();
    aKeys.sort();

    // Check all keys in exp
    for (i = 0; i &lt; eKeys.length; ++i) {
      var k = eKeys[i];
      if (act.hasOwnProperty(k)) {
        if (!compare(exp[k], act[k], path + '.' + k, opt_deep, opt_results)) {
          same = false;
        }
      } else {
        if (opt_results) {
          // opt_results.push(propertyAbsent(exp[k], null, path + '.' + k));
          strExp = format(exp[k], 100);
          var keyExp = path + '.' + k;
          if (strExp.length > 16) {
            opt_results.push(
              'Value missing expected property ' + keyExp + ' with value:\n  ' + strExp);
          } else {
            opt_results.push(
              'Value missing expected property ' + keyExp + ' with value ' + strExp + '.');
          }
        }
        same = false;
      }
    }

    // Check all keys in act
    for (i = 0; i &lt; aKeys.length; ++i) {
      var k2 = aKeys[i];
      if (!exp.hasOwnProperty(k2)) {
        if (opt_results) {
          strAct = format(act[k2], 100);
          var keyAct = path + '.' + k2;
          if (strAct.length > 16) {
            opt_results.push(
              'Value has unexpected property ' + keyAct + ' with value:\n  ' + strAct);
          } else {
            opt_results.push(
              'Value has unexpected property ' + keyAct + ' with value ' + strAct + '.');
          }
        }
        same = false;
      }
    }

    // if (opt_results &amp;&amp; opt_results.length) {
    //   console.log(opt_results);
    // }
    return same;
  } else if (et === 'string') {
    if (opt_results) {
      // find the first character where they differ
      for (i = 0; i &lt; exp.length &amp;&amp; i &lt; act.length; ++i) {
        if (exp[i] != act[i]) {
          break;
        }
      }
      // if that index &lt; 16 or strings are short, then show the whole thing:
      if (i &lt; 16 || (exp.length &lt; 60 &amp;&amp; act.length &lt; 60)) {
        opt_results.push(inequality(exp, act, path));
        return false;
      }

      // Only show the part of the string that differs.
      var start = Math.max(i - 16, 0);
      strExp = '"' + sliceWithEllipsis(exp, start, Math.min(i + 16, exp.length)) + '"';
      strAct = '"' + sliceWithEllipsis(act, start, Math.min(i + 16, act.length)) + '"';
      var msg;
      if (path) {
        msg = 'Expected value of ' + path + ' differs from actual value';
      } else {
        msg = 'Expected value differs from actual value';
      }
      msg += ' starting at character ' + i + ':';
      msg += '\n  expected: ' + strExp;
      msg += '\n    actual: ' + strAct;
      opt_results.push(msg);
      return false;
    }
    return false;
  } else {
    // buffer
    // arguments
    throw new Error('Type not handled: ' + et);
  }
}

function sliceWithEllipsis(str, start, end) {
  var result = str.slice(start, end);
  if (start > 0) {
    result = '...' + result;
  }
  if (end &lt; str.length) {
    result += '...';
  }
  return result;
}

function diff(exp, act, opt_path, opt_deep) {
  var result = [];
  compare(exp, act, opt_path, opt_deep, result);
  return result;
}

function sameValue(lhs, rhs) {
  // TODO: Handle obscure JS behaviors like +0, NaN, etc.
  return lhs === rhs;
}

module.exports = {
  compare: compare,
  diff: diff,
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun May 22 2016 13:09:21 GMT-0700 (PDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
